# æˆªå›¾æµ‹è¯•è¯´æ˜

## æ¦‚è¿°

è¿™ä¸ªæµ‹è¯•å¥—ä»¶æä¾›äº†å…¨é¢çš„æˆªå›¾æµ‹è¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- ğŸ–¼ï¸ **è‡ªåŠ¨æˆªå›¾æµ‹è¯•** - å¤šè§†å£ã€å¤šæµè§ˆå™¨ã€å¤šä¸»é¢˜
- ğŸ” **å›¾ç‰‡å¯¹æ¯”åŠŸèƒ½** - åƒç´ çº§å·®å¼‚æ£€æµ‹
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Šç”Ÿæˆ** - HTMLæ ¼å¼çš„å¯è§†åŒ–æŠ¥å‘Š
- ğŸ¯ **ç‰¹å®šåŒºåŸŸæµ‹è¯•** - ç»„ä»¶çº§åˆ«çš„æˆªå›¾å¯¹æ¯”
- ğŸš€ **é«˜æ€§èƒ½å¤„ç†** - ä¼˜åŒ–çš„å›¾ç‰‡å¤„ç†å’Œå¯¹æ¯”ç®—æ³•

## æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ screenshot.spec.ts          # ä¸»è¦æˆªå›¾æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ image-comparison.spec.ts    # å›¾ç‰‡å¯¹æ¯”æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ screenshot.config.ts        # æµ‹è¯•é…ç½®æ–‡ä»¶
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ screenshot-utils.ts     # æˆªå›¾å·¥å…·ç±»
â”œâ”€â”€ screenshots/
â”‚   â”œâ”€â”€ reference/              # å‚è€ƒå›¾ç‰‡ç›®å½•
â”‚   â”œâ”€â”€ actual/                 # å®é™…å›¾ç‰‡ç›®å½•
â”‚   â”œâ”€â”€ diff/                   # å·®å¼‚å›¾ç‰‡ç›®å½•
â”‚   â””â”€â”€ reports/                # æµ‹è¯•æŠ¥å‘Šç›®å½•
â””â”€â”€ README.md                   # è¯´æ˜æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
npm run playwright:install
```

### 2. è¿è¡Œæˆªå›¾æµ‹è¯•

```bash
# åŸºç¡€æˆªå›¾æµ‹è¯•
npm run test:screenshot

# å›¾ç‰‡å¯¹æ¯”æµ‹è¯•
npm run test:visual

# è¿è¡Œæ‰€æœ‰è§†è§‰æµ‹è¯•
npm run test:visual:all

# è°ƒè¯•æ¨¡å¼
npm run test:screenshot:debug

# æ›´æ–°å‚è€ƒå›¾ç‰‡
npm run test:screenshot:update
```

### 3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„HTMLæŠ¥å‘Šï¼š

```bash
npm run test:e2e:report
```

## æµ‹è¯•é…ç½®

### è§†å£é…ç½®

æ”¯æŒå¤šç§è®¾å¤‡è§†å£æµ‹è¯•ï¼š

- **Desktop**: 1920x1080 (æ ‡å‡†æ¡Œé¢)
- **Laptop**: 1366x768 (ç¬”è®°æœ¬)
- **Tablet**: 768x1024 (å¹³æ¿)
- **Mobile**: 375x667 (æ‰‹æœº)
- **Ultrawide**: 3440x1440 (è¶…å®½å±)

### æµè§ˆå™¨æ”¯æŒ

- âœ… Chromium (Chrome/Edge)
- âœ… Firefox
- âœ… WebKit (Safari)

### ä¸»é¢˜æµ‹è¯•

- ğŸŒ Light Mode (æµ…è‰²ä¸»é¢˜)
- ğŸŒ™ Dark Mode (æ·±è‰²ä¸»é¢˜)
- ğŸ”„ System (ç³»ç»Ÿä¸»é¢˜)

## æµ‹è¯•å¥—ä»¶

### åŸºç¡€ç•Œé¢æµ‹è¯•

æµ‹è¯•ä¸»è¦é¡µé¢çš„åŸºæœ¬æ¸²æŸ“ï¼š

```typescript
// æµ‹è¯•ä¸»é¡µåœ¨ä¸åŒè§†å£ä¸‹çš„æ˜¾ç¤º
test('ä¸»é¡µå“åº”å¼æµ‹è¯•', async ({ page }) => {
  // è‡ªåŠ¨åœ¨å¤šä¸ªè§†å£ä¸‹æµ‹è¯•
});
```

### äº¤äº’çŠ¶æ€æµ‹è¯•

æµ‹è¯•ç”¨æˆ·äº¤äº’çŠ¶æ€ï¼š

```typescript
// æµ‹è¯•æ‚¬åœã€ç„¦ç‚¹ã€é€‰ä¸­ç­‰çŠ¶æ€
test('äº¤äº’çŠ¶æ€æµ‹è¯•', async ({ page }) => {
  // æµ‹è¯•æŒ‰é’®æ‚¬åœçŠ¶æ€
  // æµ‹è¯•è¾“å…¥æ¡†ç„¦ç‚¹çŠ¶æ€
  // æµ‹è¯•èœå•å±•å¼€çŠ¶æ€
});
```

### ä¸»é¢˜å¯¹æ¯”æµ‹è¯•

æµ‹è¯•ä¸åŒä¸»é¢˜ä¸‹çš„æ˜¾ç¤ºæ•ˆæœï¼š

```typescript
// æµ‹è¯•æ·±è‰²/æµ…è‰²ä¸»é¢˜
test('ä¸»é¢˜å¯¹æ¯”æµ‹è¯•', async ({ page }) => {
  // åœ¨ä¸åŒä¸»é¢˜ä¸‹æˆªå›¾å¯¹æ¯”
});
```

### ç»„ä»¶çº§æµ‹è¯•

æµ‹è¯•ç‰¹å®šç»„ä»¶çš„æ¸²æŸ“ï¼š

```typescript
// æµ‹è¯•ä¾§è¾¹æ ç»„ä»¶
test('ä¾§è¾¹æ ç»„ä»¶æµ‹è¯•', async ({ page }) => {
  await screenshotTester.screenshotElement(
    '[data-testid="sidebar"]',
    'sidebar',
    'desktop',
    'chromium'
  );
});
```

## é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰æˆªå›¾åŒºåŸŸ

```typescript
// æˆªå›¾ç‰¹å®šåŒºåŸŸ
const customRegion = {
  clip: { x: 0, y: 0, width: 800, height: 600 }
};

await screenshotTester.compareScreenshot(
  'custom-region',
  'desktop',
  'chromium',
  customRegion
);
```

### æˆªå›¾å¯¹æ¯”é˜ˆå€¼

```typescript
// è®¾ç½®æ›´ä¸¥æ ¼çš„å¯¹æ¯”é˜ˆå€¼
const strictOptions = {
  threshold: 0.1,        // 10% å·®å¼‚é˜ˆå€¼
  maxDiffPixels: 50,     // æœ€å¤§50åƒç´ å·®å¼‚
};
```

### æ‰¹é‡å›¾ç‰‡å¤„ç†

```typescript
// æ‰¹é‡å¯¹æ¯”å¤šå¼ å›¾ç‰‡
const comparator = new ImageComparator();
const results = await comparator.batchCompareImages(
  'tests/screenshots/reference',
  'tests/screenshots/actual',
  'tests/screenshots/diff'
);
```

## æ€§èƒ½ä¼˜åŒ–

### å¹¶å‘æ‰§è¡Œ

æµ‹è¯•æ”¯æŒå¹¶å‘æ‰§è¡Œä»¥æé«˜æ•ˆç‡ï¼š

```typescript
// å¹¶å‘æµ‹è¯•å¤šä¸ªè§†å£
const viewports = ['desktop', 'tablet', 'mobile'];
await Promise.all(viewports.map(async (viewport) => {
  // å¹¶å‘æ‰§è¡Œæˆªå›¾æµ‹è¯•
}));
```

### æ™ºèƒ½ç¼“å­˜

- å›¾ç‰‡æŒ‡çº¹è¯†åˆ«ï¼Œé¿å…é‡å¤å¤„ç†
- å¢é‡å¯¹æ¯”ï¼Œåªæ£€æµ‹å˜åŒ–éƒ¨åˆ†
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ–‡ä»¶

### å†…å­˜ç®¡ç†

- æµå¼å¤„ç†å¤§å›¾ç‰‡
- è‡ªåŠ¨é‡Šæ”¾å›¾ç‰‡å†…å­˜
- ä¼˜åŒ–çš„PNGå¤„ç†ç®—æ³•

## æŠ¥å‘Šå’Œåˆ†æ

### HTMLæŠ¥å‘Š

ç”Ÿæˆè¯¦ç»†çš„HTMLæŠ¥å‘Šï¼ŒåŒ…å«ï¼š

- ğŸ“Š æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
- ğŸ–¼ï¸ æˆªå›¾å¯¹æ¯”ç»“æœ
- ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡
- ğŸ¯ å·®å¼‚é«˜äº®æ˜¾ç¤º

### å·®å¼‚åˆ†æ

- åƒç´ çº§å·®å¼‚æ£€æµ‹
- å·®å¼‚åŒºåŸŸé«˜äº®
- å·®å¼‚ç™¾åˆ†æ¯”ç»Ÿè®¡
- è§†è§‰å·®å¼‚çƒ­å›¾

### æ€§èƒ½æŠ¥å‘Š

- æˆªå›¾è€—æ—¶åˆ†æ
- å¯¹æ¯”æ€§èƒ½æŒ‡æ ‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- ä¼˜åŒ–å»ºè®®

## æœ€ä½³å®è·µ

### 1. æµ‹è¯•æ•°æ®å‡†å¤‡

```typescript
// åœ¨æµ‹è¯•å‰å‡†å¤‡ä¸€è‡´çš„æµ‹è¯•æ•°æ®
await page.evaluate(() => {
  // è®¾ç½®å›ºå®šçš„æµ‹è¯•æ•°æ®
  window.testData = {
    notes: [...],
    user: {...},
  };
});
```

### 2. ç­‰å¾…é¡µé¢ç¨³å®š

```typescript
// ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
await page.waitForLoadState('networkidle');
await page.waitForFunction(() => document.fonts.ready);
```

### 3. ç¦ç”¨åŠ¨ç”»

```typescript
// ç¦ç”¨CSSåŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
await page.addStyleTag({
  content: `
    *, *::before, *::after {
      animation-duration: 0s !important;
      transition-duration: 0s !important;
    }
  `
});
```

### 4. å¤„ç†åŠ¨æ€å†…å®¹

```typescript
// éšè—æ—¶é—´æˆ³ç­‰åŠ¨æ€å†…å®¹
await page.addStyleTag({
  content: `
    .timestamp, .current-time {
      visibility: hidden !important;
    }
  `
});
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æˆªå›¾å·®å¼‚è¿‡å¤§**
   - æ£€æŸ¥æ˜¯å¦æœ‰åŠ¨æ€å†…å®¹
   - è°ƒæ•´å¯¹æ¯”é˜ˆå€¼
   - ç¡®ä¿æµ‹è¯•æ•°æ®ä¸€è‡´

2. **æµ‹è¯•è¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - å¢åŠ è¶…æ—¶æ—¶é—´
   - ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦

3. **æµè§ˆå™¨å…¼å®¹æ€§**
   - æ£€æŸ¥æµè§ˆå™¨ç‰ˆæœ¬
   - æ›´æ–°Playwrightä¾èµ–
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### è°ƒè¯•æŠ€å·§

```bash
# å¤´éƒ¨æ¨¡å¼è¿è¡Œï¼ŒæŸ¥çœ‹å®é™…æ“ä½œ
npm run test:screenshot:headed

# è°ƒè¯•æ¨¡å¼ï¼Œé€æ­¥æ‰§è¡Œ
npm run test:screenshot:debug

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
DEBUG=pw:* npm run test:screenshot
```

## ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ

```bash
# å®½æ¾çš„å¯¹æ¯”é˜ˆå€¼ï¼Œå¿«é€Ÿåé¦ˆ
NODE_ENV=development npm run test:screenshot
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# ä¸¥æ ¼çš„å¯¹æ¯”é˜ˆå€¼ï¼Œç¡®ä¿è´¨é‡
NODE_ENV=production npm run test:screenshot
```

### CI/CDç¯å¢ƒ

```bash
# é’ˆå¯¹CIä¼˜åŒ–çš„é…ç½®
NODE_ENV=ci npm run test:screenshot
```

## æ‰©å±•åŠŸèƒ½

### è‡ªå®šä¹‰æµ‹è¯•å¥—ä»¶

```typescript
// åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•å¥—ä»¶
const customSuite = {
  name: 'Custom Test',
  viewports: ['desktop'],
  browsers: ['chromium'],
  pages: ['homepage'],
  regions: ['header', 'sidebar'],
  themes: ['light'],
};
```

### é›†æˆå…¶ä»–å·¥å…·

- ä¸Jestæµ‹è¯•æ¡†æ¶é›†æˆ
- ä¸Storybookç»„ä»¶åº“é›†æˆ
- ä¸è®¾è®¡ç³»ç»Ÿå·¥å…·é›†æˆ

## æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)

- âœ… åŸºç¡€æˆªå›¾æµ‹è¯•åŠŸèƒ½
- âœ… å¤šè§†å£å“åº”å¼æµ‹è¯•
- âœ… è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- âœ… ä¸»é¢˜å¯¹æ¯”æµ‹è¯•
- âœ… å›¾ç‰‡å·®å¼‚æ£€æµ‹
- âœ… HTMLæŠ¥å‘Šç”Ÿæˆ
- âœ… æ€§èƒ½ä¼˜åŒ–

### è®¡åˆ’åŠŸèƒ½

- ğŸ”„ è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•
- ğŸ“± ç§»åŠ¨ç«¯ä¸“é¡¹æµ‹è¯•
- ğŸ¨ è®¾è®¡ç³»ç»Ÿé›†æˆ
- ğŸ“Š è¶‹åŠ¿åˆ†ææŠ¥å‘Š
- ğŸ¤– AIé©±åŠ¨çš„å¼‚å¸¸æ£€æµ‹

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç 
4. è¿è¡Œæµ‹è¯•
5. æäº¤PR

## è®¸å¯è¯

MIT License

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** è¯·æŸ¥çœ‹[Playwrightæ–‡æ¡£](https://playwright.dev/)æˆ–æäº¤Issueã€‚